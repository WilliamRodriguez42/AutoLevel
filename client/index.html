<!DOCTYPE html>
<!-- saved from url=(0031)https://carbide3d.com/apps/pcb/ -->
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

	<title>AutoLevel</title>
	<link rel="stylesheet" type="text/css" href="client/split.css">
	<link rel="stylesheet" type="text/css" href="client/simple-console.css">
	<link rel="stylesheet" type="text/css" href="client/app.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>
<body style="background:#222">
	<div class="panel-container" style="height:100%;">
		<div class="panel-left" style="width:calc(100% - 300px);" id="left_panel1">

			<div class="page-container">
				<div class="panel-container-vertical">
					<div class="panel-top" id="top_panel" style="height:80%">
						<div class="panel-container" style="height:100%;">
							<div class="panel-left" style="width:70%;" id="left_panel2">
									<div id="main" style="position: relative;">
											<iframe src="test.svg" width="100%" height="100%"></iframe>
									</div>
							</div>

							<div class="splitter" id="v_splitter2">
							</div>

							<script>
								var mouseDown = 0;
								var mouseOver = 0;
								document.body.onmousedown = function() {
									++mouseDown;
									if (!mouseOver) {
										controls.enabled = false;
									}
								}
								document.body.onmouseup = function() {
									--mouseDown;
									if (!mouseOver) {
										controls.enabled = false;
									}
								}

								document.body.onmousemove = function() {
									if (!mouseDown && !mouseOver) {
										controls.enabled = false;
									}
								}

								function enable_three() {
									controls.enabled = true;
									mouseOver = 1;
								}

								function disable_three() {
									if (!mouseDown) {
										controls.enabled = false;
									}
									mouseOver = 0;
								}
							</script>

							<div id="viewer-div" class="panel-right" onmouseover = "enable_three();" onmouseleave = "disable_three();">


								<script src="./gv_files/three.js"></script>
								<script src="./gv_files/OrbitControls.js"></script>
								<script src="./gv_files/GCodeLoader.js"></script>

								<script>

									var container;
									var camera, scene, renderer, loader, g_object, d_object;
									var controls;

									init();
									animate();

									function load_contour(gcode) {
										scene.remove(g_object);
										g_object = loader.parse(gcode);
										scene.add(g_object);

										animate();
									}

									function load_drill(gcode) {
										scene.remove(d_object);
										d_object = loader.parse(gcode);
										scene.add(d_object);

										animate();
									}

									function animate() {

										renderer.render( scene, camera );

										requestAnimationFrame( animate );

									}

									function load_gcodes() {
										var contours = $.ajax({type: "GET", url: "contours", async: false});
										load_contour(contours.responseText);

										var drills = $.ajax({type: "GET", url: "drills", async: false});
										load_drill(drills.responseText);
									}

									function init() {

										container = document.createElement( 'div' );
										document.getElementById("viewer-div").appendChild( container );

										camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 10000 );
										camera.position.set( 0, 100, 0 );

										controls = new THREE.OrbitControls( camera );
										controls.enabled = false;

										scene = new THREE.Scene();
										loader = new THREE.GCodeLoader();



										renderer = new THREE.WebGLRenderer();
										renderer.setPixelRatio( window.devicePixelRatio );
										renderer.setSize( window.innerWidth, window.innerHeight );
										container.appendChild( renderer.domElement );

										window.addEventListener( 'resize', resize, false );

										load_gcodes();
									}

									function resize(width, height) {
										var height = $('#top_panel').height();
										var width = $("#left_panel1").width() - $('#left_panel2').width();

										camera.aspect = width / height;
										camera.updateProjectionMatrix();

										renderer.setSize( width, height );
									}

								</script>
							</div>
						</div>
							</div>

							<div class="splitter-horizontal">
							</div>

							<div id="console-window" class="panel-bottom">

							</div>
					</div>
			</div>
		</div>







		<div class="splitter" id="v_splitter1">
		</div>

		<div class="panel-right" id="right_panel1" style="margin: 20px">

			<script src="client/control_panel.js"></script>
			<table style="width:100%; color:#eee;">
				<tr>
					<th></th>
					<th><h1>Control Panel</h1></th>
					<th></th>
				</tr>
			</table>

			<br></br>

			<table style="width:100%; color:#eee;">
				<tr>
					<td></td>
					<td><button class="my_button"
								onmousedown="move_Zp()">Z+</button></td>
					<td></td>
				</tr>
				<tr>
					<td></td>
					<td><button class="my_button"
								onmousedown="move_Zn()">Z-</button></td>
					<td></td>
				</tr>
				<tr style="height:100px">
				</tr>
				<tr>
					<td></td>
					<td><button class="my_button"
								onmousedown="move_Yp()">Y+</button></td>
					<td></td>
				</tr>
				<tr>
					<td><button class="my_button"
								onmousedown="move_Xn()">X-</button></td>
					<td></td>
					<td><button class="my_button"
								onmousedown="move_Xp()">X+</button></td>
				</tr>
				<tr>
					<td></td>
					<td><button class="my_button"
								onmousedown="move_Yn()">Y-</button></td>
					<td></td>
				</tr>

			</table>

			<br></br>

			<table style="width:200px; color:#eee">
				<tr>
					<td>Distance:</td>
					<td><input id="distance_value" class="sizeInput" value="1.00"></input> mm</td>
				</tr>
			</table>

		</div>
	</div>


	<script src="/client/jquery-resizable.js"></script>
	<script>
		$(".panel-top").resizable({
				handleSelector: ".splitter-horizontal",
				resizeWidth: false
		});

		$("#left_panel1").resizable({
			 handleSelector: "#v_splitter1",
			 resizeHeight: false
		 });

		 $("#left_panel2").resizable({
 			 handleSelector: "#v_splitter2",
 			 resizeHeight: false
 		 });
	</script>

	<script src="client/js/draw_svg.js"></script>
	<script src="client/simple-console.js"></script>
	<script src="client/console.js"></script>

</body></html>
